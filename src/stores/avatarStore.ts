import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AvatarState {
  avatarUrl: string;
  isAdmin: boolean;
  setAvatarUrl: (url: string, adminKey?: string) => void;
}

const ADMIN_KEY = 'your-secret-key-here'; // In production, this should be in environment variables
const defaultAvatar = "data:image/jpeg;base64,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";

export const useAvatarStore = create<AvatarState>()(
  persist(
    (set) => ({
      avatarUrl: defaultAvatar,
      isAdmin: false,
      setAvatarUrl: (url: string, adminKey?: string) => {
        if (adminKey === ADMIN_KEY) {
          set({ avatarUrl: url });
        } else {
          console.error('Unauthorized attempt to change avatar');
        }
      },
    }),
    {
      name: 'rocket-avatar',
    }
  )
);